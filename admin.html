<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abby's Secret – Admin Panel</title>
<style>
:root{
  --bg-gradient: linear-gradient(to bottom, #000000, #1a1a1a);
  --glass-bg: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.18);
  --gold: #d4af37;
  --muted: rgba(255,255,255,0.7);
  --radius: 14px;
}

body{
margin:0;
font-family: 'Inter', sans-serif;
background: var(--bg-gradient);
color:white;
}

.topbar{
text-align:center;
padding:20px 16px;
border-bottom:1px solid rgba(255,255,255,0.1);
}

.logo{
font-size:28px;
font-weight:700;
color: var(--gold);
margin-bottom:16px;
}

.form-card{
margin:16px;
border-radius: var(--radius);
overflow:hidden;
background: var(--glass-bg);
border:1px solid var(--glass-border);
backdrop-filter: blur(10px);
}

.toggle-btn{
width:100%;
padding:12px;
font-size:16px;
font-weight:600;
background: var(--gold);
color:black;
border:none;
cursor:pointer;
transition:0.2s;
border-radius: var(--radius);
}

.toggle-btn:hover{
opacity:0.9;
}

.form-container{
padding:20px;
}

.form-container h2{
margin-top:0;
color: var(--gold);
}

.form-container input,
.form-container select,
.form-container textarea{
width:100%;
padding:10px;
margin:8px 0;
border-radius: var(--radius);
border:1px solid var(--glass-border);
background: rgba(255,255,255,0.05);
color:white;
}

.form-container textarea{
resize: vertical;
}

.submit-btn{
width:100%;
padding:12px;
background: var(--gold);
color:black;
border:none;
border-radius: var(--radius);
font-weight:600;
cursor:pointer;
transition:0.2s;
}

.submit-btn:hover{
opacity:0.9;
}

.grid{
padding:16px;
display:grid;
grid-template-columns: repeat(2, 1fr);
gap:16px;
}

@media(min-width:768px){
.grid{
grid-template-columns: repeat(3, 1fr);
}
}

@media(min-width:1024px){
.grid{
grid-template-columns: repeat(4, 1fr);
}
}

.card{
background: var(--glass-bg);
border:1px solid var(--glass-border);
backdrop-filter: blur(10px);
border-radius: var(--radius);
overflow:hidden;
box-shadow: 0 8px 20px rgba(0,0,0,0.6);
transition:0.2s;
position:relative;
}

.card:hover{
transform: translateY(-4px);
}

.card img{
width:100%;
height:200px;
object-fit: cover;
}

.card-body{
padding:12px;
}

.title{
font-size: 16px;
font-weight: 600;
}

.price{
color: var(--gold);
font-weight:700;
margin:6px 0;
}

.desc{
font-size:13px;
color: var(--muted);
margin-bottom:6px;
}

.action-btns{
display:flex;
gap:6px;
}

.edit-btn, .delete-btn{
flex:1;
padding:6px;
border:none;
border-radius: var(--radius);
font-weight:600;
cursor:pointer;
}

.edit-btn{
background: #00aaff;
color:white;
}

.delete-btn{
background: #ff4d4d;
color:white;
}
</style>

</head>
<body><div class="topbar">
  <div class="logo">Abby's Secret– Admin</div>
</div><div class="form-card">
  <button class="toggle-btn" onclick="toggleForm()">+ Add Product</button>
  <div class="form-container" id="addForm" style="display:none;">
    <h2>Add / Edit Product</h2>
    <input type="hidden" id="productId">
    <input type="text" id="name" placeholder="Product Name">
    <select id="category">
      <option value="">Select Category</option>
      <option value="Bubu">Bubu</option>
      <option value="2 Piece">2 Piece</option>
      <option value="Jumpsuit">Jumpsuit</option>
      <option value="Jeans">Jeans</option>
      <option value="Beach Wears">Beach Wears</option>
      <option value="Gowns">Gowns</option>
      <option value="Joggers">Joggers</option>
      <option value="Top">Top</option>
      <option value="Luxury Wear">Luxury Wear</option>
    </select>
    <input type="text" id="price" placeholder="Price">
    <textarea id="desc" placeholder="Description"></textarea><div style="margin-bottom:8px;">
  <img id="imagePreview" src="" style="width:100%; max-height:200px; object-fit:cover; border-radius:14px; display:none;">
</div>
<input type="file" id="imageFile" accept="image/*" onchange="updateImagePreviewFile()">

<button class="submit-btn" onclick="addOrUpdateProduct()">Save Product</button>

  </div>
</div><div class="grid" id="productGrid"></div>

<script>
const backendURL = "https://abby-vybw.onrender.com";

// COLLAPSIBLE FORM
function toggleForm(){
  const form = document.getElementById("addForm");
  form.style.display = form.style.display==="none"?"block":"none";
}

// IMAGE PREVIEW
function updateImagePreviewFile(){
  const fileInput = document.getElementById("imageFile");
  const preview = document.getElementById("imagePreview");
  if(fileInput.files && fileInput.files[0]){
    const reader = new FileReader();
    reader.onload = e=>{
      preview.src = e.target.result;
      preview.style.display="block";
    }
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    preview.style.display="none";
  }
}

// FETCH PRODUCTS FROM BACKEND
async function fetchProducts(){
  try{
    const res = await fetch(`${backendURL}/api/products`);
    const data = await res.json();
    window.products = data;
    renderProducts();
  }catch(err){
    console.error(err);
    alert("Failed to fetch products from backend");
  }
}

// RENDER PRODUCTS
function renderProducts(){
  const grid = document.getElementById("productGrid");
  grid.innerHTML="";
  window.products.forEach(p=>{
    grid.innerHTML+=`
      <div class="card">
        <img src="${p.image}">
        <div class="card-body">
          <div class="title">${p.name}</div>
          <div class="price">₦${p.price}</div>
          <div class="desc">${p.desc}</div>
          <div class="action-btns">
            <button class="edit-btn" onclick='editProduct("${p._id}")'>Edit</button>
            <button class="delete-btn" onclick='deleteProduct("${p._id}")'>Delete</button>
          </div>
        </div>
      </div>
    `;
  });
}

// ADD OR UPDATE PRODUCT
async function addOrUpdateProduct(){
  const id = document.getElementById("productId").value;
  const name = document.getElementById("name").value;
  const category = document.getElementById("category").value;
  const price = document.getElementById("price").value;
  const desc = document.getElementById("desc").value;
  const fileInput = document.getElementById("imageFile");

  if(!name || !category || !price || !desc){
    alert("Please fill all fields");
    return;
  }

  const formData = new FormData();
  formData.append("name", name);
  formData.append("category", category);
  formData.append("price", price);
  formData.append("desc", desc);
  if(fileInput.files[0]) formData.append("image", fileInput.files[0]);

  try{
    let res;
    if(id){ // update
      res = await fetch(`${backendURL}/api/products/${id}`,{
        method:"PUT",
        body: formData
      });
    } else {
      res = await fetch(`${backendURL}/api/products`,{
        method:"POST",
        body: formData
      });
    }
    const data = await res.json();
    alert(data.message || "Saved successfully");
    resetForm();
    fetchProducts();
  }catch(err){
    console.error(err);
    alert("Failed to save product");
  }
}

// EDIT PRODUCT
function editProduct(id){
  const p = window.products.find(p=>p._id===id);
  document.getElementById("productId").value = p._id;
  document.getElementById("name").value = p.name;
  document.getElementById("category").value = p.category;
  document.getElementById("price").value = p.price;
  document.getElementById("desc").value = p.desc;
  document.getElementById("imagePreview").src = p.image;
  document.getElementById("imagePreview").style.display="block";
  document.getElementById("imageFile").value="";
  document.getElementById("addForm").style.display="block";
}

// DELETE PRODUCT
async function deleteProduct(id){
  if(confirm("Are you sure you want to delete this product?")){
    try{
      const res = await fetch(`${backendURL}/api/products/${id}`,{method:"DELETE"});
      const data = await res.json();
      alert(data.message || "Deleted successfully");
      fetchProducts();
    }catch(err){
      console.error(err);
      alert("Failed to delete product");
    }
  }
}

// RESET FORM
function resetForm(){
  document.getElementById("productId").value="";
  document.getElementById("name").value="";
  document.getElementById("category").value="";
  document.getElementById("price").value="";
  document.getElementById("desc").value="";
  document.getElementById("imageFile").value="";
  document.getElementById("imagePreview").style.display="none";
}

// INITIAL FETCH
fetchProducts();
</script>
</body>
</html>