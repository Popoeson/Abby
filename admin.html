<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abby's Secret – Admin Panel</title>

<style>
:root{
  --bg-gradient: linear-gradient(to bottom, #000000, #1a1a1a);
  --glass-bg: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.18);
  --gold: #d4af37;
  --muted: rgba(255,255,255,0.7);
  --radius: 14px;
}

body{
  margin:0;
  font-family: Inter, sans-serif;
  background: var(--bg-gradient);
  color:white;
}

.topbar{
  text-align:center;
  padding:20px 16px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.logo{
  font-size:28px;
  font-weight:700;
  color:var(--gold);
}

.search-wrap{
  padding:14px 16px;
}

.search-wrap input{
  width:98%;
  padding:12px;
  border-radius:50px;
  border:1px solid var(--glass-border);
  background:var(--glass-bg);
  color:white;
  outline:none;
}

/* ---------- form ---------- */
.form-card{
  margin:16px;
  background:var(--glass-bg);
  border:1px solid var(--glass-border);
  border-radius:var(--radius);
}

.toggle-btn{
  width:100%;
  padding:12px;
  font-size:16px;
  font-weight:600;
  background:var(--gold);
  border:none;
  border-radius:var(--radius);
  cursor:pointer;
}

.form-container{
  padding:20px;
  display:none;
}

.form-container input,
.form-container select,
.form-container textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:var(--radius);
  border:1px solid var(--glass-border);
  background:rgba(255,255,255,0.05);
  color:white;
}

.stock-row{
  display:flex;
  gap:10px;
  align-items:center;
}

.submit-btn{
  width:100%;
  padding:12px;
  background:var(--gold);
  border:none;
  border-radius:var(--radius);
  font-weight:600;
  cursor:pointer;
}

/* ---------- grid ---------- */
.grid{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
}

@media(min-width:768px){ .grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1024px){ .grid{ grid-template-columns:repeat(4,1fr); } }

.card{
  background:var(--glass-bg);
  border:1px solid var(--glass-border);
  border-radius:var(--radius);
  overflow:hidden;
}

.card img{
  width:100%;
  height:200px;
  object-fit:cover;
}

.card-body{ padding:12px; }
.title{ font-weight:600; }
.price{ color:var(--gold); margin:6px 0; }
.desc{ font-size:13px; color:var(--muted); }

.stock-status{ font-size:13px; margin-top:6px; }
.in-stock{ color:#4caf50; }
.out-stock{ color:#ff4d4d; }

.action-btns{
  display:flex;
  gap:6px;
  margin-top:10px;
}

.edit-btn{ background:#00aaff; }
.delete-btn{ background:#ff4d4d; }
.edit-btn,.delete-btn{
  flex:1;
  border:none;
  padding:6px;
  color:white;
  border-radius:var(--radius);
  cursor:pointer;
}

/* ---------- pagination ---------- */
.pagination{
  display:flex;
  justify-content:center;
  gap:8px;
  margin:20px 0 40px;
}

.page-btn{
  padding:6px 14px;
  border-radius:50px;
  border:1px solid var(--glass-border);
  background:var(--glass-bg);
  color:white;
  cursor:pointer;
}

.page-btn.active{
  background:var(--gold);
  color:black;
}

/* ---------- spinner ---------- */
.spinner-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.spinner{
  width:50px;
  height:50px;
  border:4px solid rgba(255,255,255,0.2);
  border-top:4px solid var(--gold);
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{ to{ transform:rotate(360deg); } }
</style>
</head>

<body>

<div class="topbar">
  <div class="logo">Abby's Secret – Admin</div>
</div>

<div class="search-wrap">
  <input id="searchInput" placeholder="Search products...">
</div>

<div class="form-card">
  <button class="toggle-btn" onclick="toggleForm()">+ Add Product</button>

  <div class="form-container" id="addForm">
    <input type="hidden" id="productId">

    <input id="name" placeholder="Product Name">

    <!-- CATEGORY SELECT -->
    <select id="category">
      <option value="">Select Category</option>
      <option>Bubu</option>
      <option>2 Piece</option>
      <option>Jumpsuit</option>
      <option>Jeans</option>
      <option>Beach Wears</option>
      <option>Gowns</option>
      <option>Joggers</option>
      <option>Top</option>
      <option>Luxury Wear</option>
    </select>

    <input id="price" placeholder="Price">
    <textarea id="desc" placeholder="Description"></textarea>

    <div class="stock-row">
      <input type="number" id="stock" placeholder="Stock">
      <label><input type="checkbox" id="outOfStock"> Out of Stock</label>
    </div>

    <input type="file" id="imageFile" accept="image/*" onchange="updateImagePreview()">
    <img id="imagePreview" style="display:none;height:100px;width:auto;border-radius:8px;margin-top:6px;object-fit:cover;">

    <button class="submit-btn" id="saveBtn" onclick="addOrUpdateProduct()">Save Product</button>
  </div>
</div>

<div class="grid" id="productGrid"></div>
<div class="pagination" id="pagination"></div>

<div class="spinner-overlay" id="spinner">
  <div class="spinner"></div>
</div>

<script>
const backendURL = "https://abby-vybw.onrender.com";
let products = [], filtered = [], page = 1;
const perPage = 8;

/* ---------- DOM References ---------- */
const addForm = document.getElementById("addForm");
const productGrid = document.getElementById("productGrid");
const pagination = document.getElementById("pagination");
const searchInput = document.getElementById("searchInput");
const spinner = document.getElementById("spinner");
const saveBtn = document.getElementById("saveBtn");

const nameInput = document.getElementById("name");
const categoryInput = document.getElementById("category");
const priceInput = document.getElementById("price");
const descInput = document.getElementById("desc");
const stockInput = document.getElementById("stock");
const outOfStockInput = document.getElementById("outOfStock");
const productIdInput = document.getElementById("productId");
const imageFileInput = document.getElementById("imageFile");
const imagePreview = document.getElementById("imagePreview");

/* ---------- UI ---------- */
function toggleForm(){
  addForm.style.display = addForm.style.display === "block" ? "none" : "block";
}

function setLoading(v){
  spinner.style.display = v ? "flex" : "none";
  saveBtn.disabled = v;
  saveBtn.innerText = v ? "Saving..." : "Save Product";
}

/* ---------- FETCH ---------- */
async function fetchProducts(){
  const res = await fetch(`${backendURL}/products`);
  products = await res.json();
  filtered = [...products];
  page = 1;
  render();
}

/* ---------- RENDER ---------- */
function render(){
  productGrid.innerHTML = "";

  const slice = filtered.slice((page - 1) * perPage, page * perPage);

  slice.forEach(p=>{
    productGrid.innerHTML += `
      <div class="card">
        <img src="${p.image}">
        <div class="card-body">
          <div class="title">${p.name}</div>
          <div class="price">₦${p.price}</div>
          <div class="desc">${p.desc || ""}</div>
          <div class="stock-status ${p.isOutOfStock ? 'out-stock' : 'in-stock'}">
            ${p.isOutOfStock ? '❌ Out of Stock' : `✅ Stock: ${p.stock}`}
          </div>
          <div class="action-btns">
            <button class="edit-btn" onclick="editProduct('${p._id}')">Edit</button>
            <button class="delete-btn" onclick="deleteProduct('${p._id}')">Delete</button>
          </div>
        </div>
      </div>`;
  });

  renderPagination();
}

/* ---------- PAGINATION ---------- */
function renderPagination(){
  pagination.innerHTML = "";
  const pages = Math.ceil(filtered.length / perPage);

  for(let i=1;i<=pages;i++){
    pagination.innerHTML += `
      <button class="page-btn ${i===page?'active':''}"
        onclick="page=${i};render()">${i}</button>`;
  }
}

/* ---------- SEARCH ---------- */
searchInput.oninput = e=>{
  const q = e.target.value.toLowerCase();
  filtered = products.filter(p =>
    p.name.toLowerCase().includes(q)
  );
  page = 1;
  render();
};

/* ---------- IMAGE PREVIEW ---------- */
function updateImagePreview(){
  const file = imageFileInput.files[0];
  if(!file) {
    imagePreview.style.display = "none";
    return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    imagePreview.src = e.target.result;
    imagePreview.style.display = "block";
  };
  reader.readAsDataURL(file);
}

/* ---------- ADD / UPDATE ---------- */
async function addOrUpdateProduct(){
  if (!nameInput.value.trim()) {
    alert("Product name is required");
    return;
  }

  setLoading(true);

  const fd = new FormData();
  fd.append("name", nameInput.value.trim());
  fd.append("category", categoryInput.value);
  fd.append("price", priceInput.value.trim());
  fd.append("desc", descInput.value.trim());
  fd.append("stock", stockInput.value || 0);
  fd.append("isOutOfStock", outOfStockInput.checked);

  if (imageFileInput.files[0]) {
    fd.append("image", imageFileInput.files[0]);
  }

  const url = productIdInput.value
    ? `${backendURL}/products/${productIdInput.value}`
    : `${backendURL}/products`;

  await fetch(url, {
    method: productIdInput.value ? "PUT" : "POST",
    body: fd
  });

  resetForm();
  fetchProducts();
  setLoading(false);
}

/* ---------- EDIT ---------- */
function editProduct(id){
  const p = products.find(x => x._id === id);
  if (!p) return;

  productIdInput.value = p._id;
  nameInput.value = p.name || "";
  categoryInput.value = p.category || "";
  priceInput.value = p.price || "";
  descInput.value = p.desc || "";
  stockInput.value = p.stock ?? 0;
  outOfStockInput.checked = p.isOutOfStock || false;

  if(p.image){
    imagePreview.src = p.image;
    imagePreview.style.display = "block";
  } else {
    imagePreview.style.display = "none";
  }

  addForm.style.display = "block";
}

/* ---------- DELETE ---------- */
async function deleteProduct(id){
  if(confirm("Delete product?")){
    await fetch(`${backendURL}/products/${id}`,{method:"DELETE"});
    fetchProducts();
  }
}

/* ---------- RESET ---------- */
function resetForm(){
  productIdInput.value = "";
  nameInput.value = "";
  categoryInput.value = "";
  priceInput.value = "";
  descInput.value = "";
  stockInput.value = "";
  outOfStockInput.checked = false;
  imageFileInput.value = "";
  imagePreview.style.display = "none";
}

/* ---------- INIT ---------- */
fetchProducts();
</script>
</body>
</html>