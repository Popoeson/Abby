<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abby's Secret – Admin Panel</title>

<style>
:root{
  --bg-gradient: linear-gradient(to bottom, #000000, #1a1a1a);
  --glass-bg: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.18);
  --gold: #d4af37;
  --muted: rgba(255,255,255,0.7);
  --radius: 14px;
}

body{
  margin:0;
  font-family: 'Inter', sans-serif;
  background: var(--bg-gradient);
  color:white;
}

.topbar{
  text-align:center;
  padding:20px 16px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.logo{
  font-size:28px;
  font-weight:700;
  color: var(--gold);
  margin-bottom:16px;
}

.form-card{
  margin:16px;
  border-radius: var(--radius);
  overflow:hidden;
  background: var(--glass-bg);
  border:1px solid var(--glass-border);
  backdrop-filter: blur(10px);
}

.toggle-btn{
  width:100%;
  padding:12px;
  font-size:16px;
  font-weight:600;
  background: var(--gold);
  color:black;
  border:none;
  cursor:pointer;
  border-radius: var(--radius);
}

.form-container{
  padding:20px;
}

.form-container h2{
  margin-top:0;
  color: var(--gold);
}

.form-container input,
.form-container select,
.form-container textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius: var(--radius);
  border:1px solid var(--glass-border);
  background: rgba(255,255,255,0.05);
  color:white;
}

.form-container textarea{
  resize: vertical;
}

.stock-row{
  display:flex;
  gap:12px;
  align-items:center;
}

.stock-row input[type="number"]{
  flex:1;
}

.stock-row label{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:14px;
  color:var(--muted);
}

.submit-btn{
  width:100%;
  padding:12px;
  background: var(--gold);
  color:black;
  border:none;
  border-radius: var(--radius);
  font-weight:600;
  cursor:pointer;
}

.grid{
  padding:16px;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:16px;
}

@media(min-width:768px){
  .grid{ grid-template-columns: repeat(3, 1fr); }
}
@media(min-width:1024px){
  .grid{ grid-template-columns: repeat(4, 1fr); }
}

.card{
  background: var(--glass-bg);
  border:1px solid var(--glass-border);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  overflow:hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}

.card img{
  width:100%;
  height:200px;
  object-fit: cover;
}

.card-body{
  padding:12px;
}

.title{
  font-size:16px;
  font-weight:600;
}

.price{
  color: var(--gold);
  font-weight:700;
  margin:6px 0;
}

.desc{
  font-size:13px;
  color: var(--muted);
}

.stock-status{
  margin-top:6px;
  font-size:13px;
  font-weight:600;
}

.in-stock{ color:#4caf50; }
.out-stock{ color:#ff4d4d; }

.action-btns{
  display:flex;
  gap:6px;
  margin-top:10px;
}

.edit-btn, .delete-btn{
  flex:1;
  padding:6px;
  border:none;
  border-radius: var(--radius);
  font-weight:600;
  cursor:pointer;
}

.edit-btn{ background:#00aaff; color:white; }
.delete-btn{ background:#ff4d4d; color:white; }
</style>
</head>

<body>

<div class="topbar">
  <div class="logo">Abby's Secret – Admin</div>
</div>

<div class="form-card">
  <button class="toggle-btn" onclick="toggleForm()">+ Add Product</button>

  <div class="form-container" id="addForm" style="display:none;">
    <h2>Add / Edit Product</h2>

    <input type="hidden" id="productId">

    <input type="text" id="name" placeholder="Product Name">

    <select id="category">
      <option value="">Select Category</option>
      <option>Bubu</option>
      <option>2 Piece</option>
      <option>Jumpsuit</option>
      <option>Jeans</option>
      <option>Beach Wears</option>
      <option>Gowns</option>
      <option>Joggers</option>
      <option>Top</option>
      <option>Luxury Wear</option>
    </select>

    <input type="text" id="price" placeholder="Price">
    <textarea id="desc" placeholder="Description"></textarea>

    <!-- STOCK CONTROLS -->
    <div class="stock-row">
      <input type="number" id="stock" placeholder="Stock Quantity" min="0">
      <label>
        <input type="checkbox" id="outOfStock">
        Out of Stock
      </label>
    </div>

    <div style="margin:10px 0;">
      <img id="imagePreview" style="width:100%;max-height:200px;object-fit:cover;border-radius:14px;display:none;">
    </div>

    <input type="file" id="imageFile" accept="image/*" onchange="updateImagePreviewFile()">

    <button class="submit-btn" onclick="addOrUpdateProduct()">Save Product</button>
  </div>
</div>

<div class="grid" id="productGrid"></div>

<script>
const backendURL = "https://abby-vybw.onrender.com";

// Toggle form
function toggleForm(){
  const f = document.getElementById("addForm");
  f.style.display = f.style.display === "none" ? "block" : "none";
}

// Image preview
function updateImagePreviewFile(){
  const file = imageFile.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e=>{
    imagePreview.src = e.target.result;
    imagePreview.style.display="block";
  };
  reader.readAsDataURL(file);
}

// Fetch products
async function fetchProducts(){
  const res = await fetch(`${backendURL}/products`);
  window.products = await res.json();
  renderProducts();
}

// Render products
function renderProducts(){
  productGrid.innerHTML = "";
  products.forEach(p=>{
    const stockText = (p.isOutOfStock || p.stock === 0)
      ? `<div class="stock-status out-stock">❌ Out of Stock</div>`
      : `<div class="stock-status in-stock">✅ Stock: ${p.stock}</div>`;

    productGrid.innerHTML += `
      <div class="card">
        <img src="${p.image}">
        <div class="card-body">
          <div class="title">${p.name}</div>
          <div class="price">₦${p.price}</div>
          <div class="desc">${p.desc}</div>
          ${stockText}
          <div class="action-btns">
            <button class="edit-btn" onclick="editProduct('${p._id}')">Edit</button>
            <button class="delete-btn" onclick="deleteProduct('${p._id}')">Delete</button>
          </div>
        </div>
      </div>
    `;
  });
}

// Add or update
async function addOrUpdateProduct(){
  const fd = new FormData();
  fd.append("name", name.value);
  fd.append("category", category.value);
  fd.append("price", price.value);
  fd.append("desc", desc.value);
  fd.append("stock", stock.value || 0);
  fd.append("isOutOfStock", outOfStock.checked);
  if(imageFile.files[0]) fd.append("image", imageFile.files[0]);

  const url = productId.value
    ? `${backendURL}/products/${productId.value}`
    : `${backendURL}/products`;

  await fetch(url,{ method: productId.value ? "PUT" : "POST", body: fd });
  resetForm();
  fetchProducts();
}

// Edit
function editProduct(id){
  const p = products.find(x=>x._id===id);
  productId.value = p._id;
  name.value = p.name;
  category.value = p.category;
  price.value = p.price;
  desc.value = p.desc;
  stock.value = p.stock ?? 0;
  outOfStock.checked = p.isOutOfStock || false;
  imagePreview.src = p.image;
  imagePreview.style.display="block";
  addForm.style.display="block";
}

// Delete
async function deleteProduct(id){
  if(confirm("Delete product?")){
    await fetch(`${backendURL}/products/${id}`,{method:"DELETE"});
    fetchProducts();
  }
}

// Reset
function resetForm(){
  addForm.reset?.();
  productId.value="";
  imagePreview.style.display="none";
}

fetchProducts();
</script>

</body>
</html>