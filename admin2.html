<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abby's Secret – Admin Panel</title>

<style>
:root{
  --bg-gradient: linear-gradient(to bottom, #000000, #1a1a1a);
  --glass-bg: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.18);
  --gold: #d4af37;
  --muted: rgba(255,255,255,0.7);
  --radius: 14px;
}

body{
  margin:0;
  font-family: Inter, sans-serif;
  background: var(--bg-gradient);
  color:white;
}

.topbar{
  text-align:center;
  padding:20px 16px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.logo{
  font-size:28px;
  font-weight:700;
  color:var(--gold);
}

.search-wrap{
  padding:14px 16px;
}

.search-wrap input{
  width:100%;
  padding:12px;
  border-radius:50px;
  border:1px solid var(--glass-border);
  background:var(--glass-bg);
  color:white;
  outline:none;
}

/* ---------- form ---------- */
.form-card{
  margin:16px;
  background:var(--glass-bg);
  border:1px solid var(--glass-border);
  border-radius:var(--radius);
}

.toggle-btn{
  width:100%;
  padding:12px;
  font-size:16px;
  font-weight:600;
  background:var(--gold);
  border:none;
  cursor:pointer;
}

.form-container{
  padding:20px;
  display:none;
}

.form-container input,
.form-container select,
.form-container textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:var(--radius);
  border:1px solid var(--glass-border);
  background:rgba(255,255,255,0.05);
  color:white;
}

.stock-row{
  display:flex;
  gap:10px;
  align-items:center;
}

.submit-btn{
  width:100%;
  padding:12px;
  background:var(--gold);
  border:none;
  border-radius:var(--radius);
  font-weight:600;
  cursor:pointer;
}

/* ---------- grid ---------- */
.grid{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
}

@media(min-width:768px){ .grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1024px){ .grid{ grid-template-columns:repeat(4,1fr); } }

.card{
  background:var(--glass-bg);
  border:1px solid var(--glass-border);
  border-radius:var(--radius);
  overflow:hidden;
}

.card img{
  width:100%;
  height:200px;
  object-fit:cover;
}

.card-body{ padding:12px; }
.title{ font-weight:600; }
.price{ color:var(--gold); margin:6px 0; }
.desc{ font-size:13px; color:var(--muted); }

.stock-status{ font-size:13px; margin-top:6px; }
.in-stock{ color:#4caf50; }
.out-stock{ color:#ff4d4d; }

.action-btns{
  display:flex;
  gap:6px;
  margin-top:10px;
}

.edit-btn{ background:#00aaff; }
.delete-btn{ background:#ff4d4d; }
.edit-btn,.delete-btn{
  flex:1;
  border:none;
  padding:6px;
  color:white;
  border-radius:var(--radius);
  cursor:pointer;
}

/* ---------- pagination ---------- */
.pagination{
  display:flex;
  justify-content:center;
  gap:8px;
  margin:20px 0 40px;
}

.page-btn{
  padding:6px 14px;
  border-radius:50px;
  border:1px solid var(--glass-border);
  background:var(--glass-bg);
  color:white;
  cursor:pointer;
}

.page-btn.active{
  background:var(--gold);
  color:black;
}

/* ---------- spinner ---------- */
.spinner-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.spinner{
  width:50px;
  height:50px;
  border:4px solid rgba(255,255,255,0.2);
  border-top:4px solid var(--gold);
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{ to{ transform:rotate(360deg); } }
</style>
</head>

<body>

<div class="topbar">
  <div class="logo">Abby's Secret – Admin</div>
</div>

<div class="search-wrap">
  <input id="searchInput" placeholder="Search products...">
</div>

<div class="form-card">
  <button class="toggle-btn" onclick="toggleForm()">+ Add Product</button>

  <div class="form-container" id="addForm">
    <input type="hidden" id="productId">
    <input id="name" placeholder="Product Name">
    <input id="price" placeholder="Price">
    <textarea id="desc" placeholder="Description"></textarea>
    <input type="number" id="stock" placeholder="Stock">
    <label><input type="checkbox" id="outOfStock"> Out of Stock</label>
    <input type="file" id="imageFile">
    <button class="submit-btn" id="saveBtn" onclick="addOrUpdateProduct()">Save Product</button>
  </div>
</div>

<div class="grid" id="productGrid"></div>
<div class="pagination" id="pagination"></div>

<div class="spinner-overlay" id="spinner">
  <div class="spinner"></div>
</div>

<script>
const backendURL = "https://abby-vybw.onrender.com";
let products=[], filtered=[], page=1;
const perPage=8;

const spinner=document.getElementById("spinner");
const saveBtn=document.getElementById("saveBtn");

function toggleForm(){
  addForm.style.display = addForm.style.display==="block"?"none":"block";
}

function setLoading(v){
  spinner.style.display=v?"flex":"none";
  saveBtn.disabled=v;
  saveBtn.innerText=v?"Saving...":"Save Product";
}

async function fetchProducts(){
  const res=await fetch(`${backendURL}/products`);
  products=await res.json();
  filtered=[...products];
  page=1;
  render();
}

function render(){
  productGrid.innerHTML="";
  const slice=filtered.slice((page-1)*perPage,page*perPage);
  slice.forEach(p=>{
    productGrid.innerHTML+=`
      <div class="card">
        <img src="${p.image}">
        <div class="card-body">
          <div class="title">${p.name}</div>
          <div class="price">₦${p.price}</div>
          <div class="desc">${p.desc}</div>
          <div class="stock-status ${p.isOutOfStock?'out-stock':'in-stock'}">
            ${p.isOutOfStock?'Out of stock':'Stock: '+p.stock}
          </div>
          <div class="action-btns">
            <button class="edit-btn" onclick="editProduct('${p._id}')">Edit</button>
            <button class="delete-btn" onclick="deleteProduct('${p._id}')">Delete</button>
          </div>
        </div>
      </div>`;
  });
  renderPagination();
}

function renderPagination(){
  pagination.innerHTML="";
  const pages=Math.ceil(filtered.length/perPage);
  for(let i=1;i<=pages;i++){
    pagination.innerHTML+=`<button class="page-btn ${i===page?'active':''}" onclick="page=${i};render()">${i}</button>`;
  }
}

searchInput.oninput=e=>{
  filtered=products.filter(p=>p.name.toLowerCase().includes(e.target.value.toLowerCase()));
  page=1; render();
};

async function addOrUpdateProduct(){
  if(!name.value.trim()) return alert("Name required");
  setLoading(true);
  const fd=new FormData();
  ["name","price","desc","stock"].forEach(id=>fd.append(id,window[id].value));
  fd.append("isOutOfStock",outOfStock.checked);
  if(imageFile.files[0]) fd.append("image",imageFile.files[0]);

  const url=productId.value?`${backendURL}/products/${productId.value}`:`${backendURL}/products`;
  await fetch(url,{method:productId.value?"PUT":"POST",body:fd});
  resetForm(); fetchProducts(); setLoading(false);
}

function editProduct(id){
  const p=products.find(x=>x._id===id);
  Object.assign(name,{value:p.name});
  Object.assign(price,{value:p.price});
  Object.assign(desc,{value:p.desc});
  Object.assign(stock,{value:p.stock});
  outOfStock.checked=p.isOutOfStock;
  productId.value=p._id;
  addForm.style.display="block";
}

async function deleteProduct(id){
  if(confirm("Delete product?")){
    await fetch(`${backendURL}/products/${id}`,{method:"DELETE"});
    fetchProducts();
  }
}

function resetForm(){
  productId.value="";
  name.value=price.value=desc.value=stock.value="";
  outOfStock.checked=false;
}

fetchProducts();
</script>
</body>
</html>